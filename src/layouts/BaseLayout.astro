---
import type { ImageMetadata } from 'astro';
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import JsonLd from '../components/seo/JsonLd.astro';
import { siteConfig } from '../config/site';

interface Props {
  title: string;
  description?: string;
  heroImage?: ImageMetadata | string;
  // Article-specific props for enhanced meta tags
  article?: {
    publishedTime: Date;
    modifiedTime?: Date;
    author?: string;
    section?: string;
  };
}

const { title, description = siteConfig.tagline, heroImage, article } = Astro.props;
const fullTitle = title === siteConfig.name ? title : `${title} | ${siteConfig.name}`;

// Canonical URL
const canonicalURL = new URL(Astro.url.pathname, Astro.site);

// Resolve heroImage to a URL string for meta tags
const heroImageUrl = heroImage
  ? typeof heroImage === 'string'
    ? heroImage
    : heroImage.src
  : undefined;

// Organization schema (for site-wide presence)
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: siteConfig.author.name,
  url: siteConfig.url,
  description: siteConfig.description,
  sameAs: [
    siteConfig.social.instagram,
    siteConfig.social.tiktok,
    siteConfig.social.youtube,
  ],
};

// Website schema
const websiteSchema = {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: siteConfig.name,
  url: siteConfig.url,
  description: siteConfig.description,
  author: {
    '@type': 'Person',
    name: siteConfig.author.name,
  },
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="generator" content={Astro.generator} />

    <!-- Geo Meta Tags (for Croatia-focused content) -->
    <meta name="geo.region" content={siteConfig.geo.region} />
    <meta name="geo.placename" content={siteConfig.geo.placename} />
    <meta name="geo.position" content={`${siteConfig.geo.latitude};${siteConfig.geo.longitude}`} />
    <meta name="ICBM" content={`${siteConfig.geo.latitude}, ${siteConfig.geo.longitude}`} />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph -->
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={article ? 'article' : 'website'} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:site_name" content={siteConfig.name} />
    <meta property="og:locale" content="en_US" />
    {heroImageUrl && <meta property="og:image" content={heroImageUrl} />}

    {/* Article-specific Open Graph tags */}
    {article && (
      <>
        <meta property="article:published_time" content={article.publishedTime.toISOString()} />
        {article.modifiedTime && <meta property="article:modified_time" content={article.modifiedTime.toISOString()} />}
        <meta property="article:author" content={article.author || siteConfig.author.name} />
        {article.section && <meta property="article:section" content={article.section} />}
      </>
    )}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    {heroImageUrl && <meta name="twitter:image" content={heroImageUrl} />}

    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{fullTitle}</title>

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="https://www.instagram.com" />
    <link rel="dns-prefetch" href="https://www.tiktok.com" />
    <link rel="dns-prefetch" href="https://www.youtube.com" />

    <!-- Structured Data -->
    <JsonLd data={organizationSchema} />
    <JsonLd data={websiteSchema} />
  </head>
  <body class="min-h-screen bg-background text-text antialiased font-display">
    <Header />

    <slot />

    <Footer />
  </body>
</html>
