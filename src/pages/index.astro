---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import CategoryCard from '../components/CategoryCard.astro';
import Sidebar from '../components/Sidebar.astro';
import { siteConfig, categoryConfig } from '../config/site';
import { gabrielHero } from '../images';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const featuredPost = posts[0];
const recentPosts = posts.slice(1, 5);
const categories = Object.keys(categoryConfig) as (keyof typeof categoryConfig)[];
---

<BaseLayout title={siteConfig.seo.home.title} description={siteConfig.seo.home.description}>
  <!-- Hero Section -->
  <header class="relative overflow-hidden bg-cream py-16 lg:py-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <div class="relative z-10">
          <div class="inline-block px-4 py-1.5 mb-6 rounded-full bg-primary/10 text-primary font-bold text-xs uppercase tracking-widest">
            A Latino in the Balkans
          </div>
          <h1 class="text-3xl sm:text-5xl lg:text-7xl font-extrabold text-text leading-[1.1] mb-6">
            I make Croatian culture make sense by{' '}
            <span class="text-primary italic">not understanding it</span>{' '}
            at all.
          </h1>
          <p class="text-xl text-gray-600 mb-8 max-w-lg">
            A Venezuelan's guide to being perpetually lost in translation, from the Dalmatian coast to the Zagreb fog.
          </p>
          <div class="flex flex-wrap gap-4">
            <a href="/blog" class="btn-primary text-lg px-8 py-4 rounded-xl">
              Start Exploring
            </a>
            <a href="#about" class="btn-secondary text-lg px-8 py-4 rounded-xl">
              About Gabriel
            </a>
          </div>
        </div>
        <div class="relative">
          <div class="aspect-[3/4] sm:aspect-[4/5] rounded-3xl overflow-hidden shadow-2xl rotate-2 hover:rotate-0 transition-transform duration-500 bg-gray-200">
            <Image
              src={gabrielHero}
              alt="Gabriel looking confused in front of St. Mark's Church in Zagreb"
              class="w-full h-full object-cover object-[center_20%]"
              widths={[400, 800]}
              sizes="(max-width: 768px) 400px, 800px"
            />
          </div>
          <div class="absolute -bottom-6 -left-6 bg-white p-6 rounded-2xl shadow-xl max-w-[240px] -rotate-3">
            <p class="text-sm font-medium italic">
              {siteConfig.hero.quote}
            </p>
            <p class="text-xs text-gray-400 mt-2">{siteConfig.hero.quoteAttribution}</p>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
    <div class="grid lg:grid-cols-12 gap-12">
      <!-- Posts Column -->
      <div class="lg:col-span-8">
        <!-- Latest Disaster (Featured Post) -->
        {featuredPost && (
          <section class="mb-20">
            <div class="flex items-center gap-4 mb-8">
              <h2 class="text-3xl font-extrabold">Latest Disaster</h2>
              <div class="h-px flex-grow bg-border"></div>
            </div>
            <PostCard post={featuredPost} featured />
          </section>
        )}

        <!-- Choose Your Struggle (Categories) -->
        <section class="mb-20">
          <h2 class="text-3xl font-extrabold mb-10">Choose Your Struggle</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            {categories.map((category) => (
              <CategoryCard category={category} />
            ))}
          </div>
        </section>

        <!-- The Confusion Feed -->
        {recentPosts.length > 0 && (
          <section>
            <h2 class="text-3xl font-extrabold mb-10">The Confusion Feed</h2>
            <div class="grid md:grid-cols-2 gap-6">
              {recentPosts.map((post) => (
                <PostCard post={post} />
              ))}
            </div>
            {posts.length > 5 && (
              <div class="text-center mt-12">
                <a
                  href="/blog"
                  class="inline-flex items-center gap-2 text-primary font-bold hover:underline"
                >
                  View all posts
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </a>
              </div>
            )}
          </section>
        )}
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-4" id="about">
        <div class="sticky top-28">
          <Sidebar
            statusConfusionLevel={featuredPost?.data.statusConfusionLevel}
            statusTemperature={featuredPost?.data.statusTemperature}
            statusSocialBattery={featuredPost?.data.statusSocialBattery}
            location={featuredPost?.data.location}
            region={featuredPost?.data.region}
          />
        </div>
      </div>
    </div>
  </main>
</BaseLayout>
