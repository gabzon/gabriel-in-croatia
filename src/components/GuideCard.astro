---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import GuideTypeBadge from './GuideTypeBadge.astro';
import { priceRangeConfig, type PriceRangeKey } from '../config/site';
import { MapPin } from 'lucide-astro';

interface Props {
  guide: CollectionEntry<'guides'>;
}

const { guide } = Astro.props;
const { title, description, pubDate, heroImage, guideType, priceRange, location, neighborhood } = guide.data;

// Calculate reading time
const content = guide.body || '';
const wordCount = content.split(/\s+/).length;
const readingTime = Math.max(1, Math.ceil(wordCount / 200));

const priceConfig = priceRange ? priceRangeConfig[priceRange as PriceRangeKey] : null;
---

<article class="group bg-white rounded-2xl p-4 shadow-sm border border-border hover:shadow-lg transition-all">
  {heroImage && (
    <a href={`/guides/${guide.slug}`}>
      {typeof heroImage === 'string' ? (
        <img
          src={heroImage}
          alt={title}
          class="w-full h-48 object-cover rounded-xl mb-4"
        />
      ) : (
        <Image
          src={heroImage}
          alt={title}
          class="w-full h-48 object-cover rounded-xl mb-4"
          widths={[400, 800]}
          sizes="(max-width: 768px) 100vw, 400px"
        />
      )}
    </a>
  )}
  <div class="flex items-center gap-2 mb-2">
    <GuideTypeBadge guideType={guideType} />
    {priceConfig && (
      <span class={`px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider rounded-full ${priceConfig.bgColor} ${priceConfig.textColor}`}>
        {priceConfig.label}
      </span>
    )}
  </div>
  <h3 class="text-xl font-bold group-hover:text-primary transition-colors mb-2">
    <a href={`/guides/${guide.slug}`}>{title}</a>
  </h3>
  <p class="text-gray-600 text-sm mb-3 line-clamp-2">{description}</p>
  <div class="flex items-center gap-2 text-xs text-gray-400">
    <div class="flex items-center gap-1">
      <MapPin class="w-3 h-3" />
      <span>{location}{neighborhood ? `, ${neighborhood}` : ''}</span>
    </div>
    <span>•</span>
    <time datetime={pubDate.toISOString()}>
      {pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
    </time>
    <span>•</span>
    <span>{readingTime} min read</span>
  </div>
</article>
