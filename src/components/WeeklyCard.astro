---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { Calendar, MapPin } from 'lucide-astro';

interface Props {
  weekly: CollectionEntry<'weekly'>;
}

const { weekly } = Astro.props;
const { title, description, weekStart, weekEnd, heroImage, location } = weekly.data;

// Format the week date range
const formatDate = (date: Date) => date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
const weekRange = `${formatDate(weekStart)} - ${formatDate(weekEnd)}, ${weekStart.getFullYear()}`;

// Calculate reading time
const content = weekly.body || '';
const wordCount = content.split(/\s+/).length;
const readingTime = Math.max(1, Math.ceil(wordCount / 200));
---

<article class="group bg-white rounded-2xl p-4 shadow-sm border border-border hover:shadow-lg transition-all">
  {heroImage && (
    <a href={`/weekly/${weekly.slug}`}>
      {typeof heroImage === 'string' ? (
        <img
          src={heroImage}
          alt={title}
          class="w-full h-48 object-cover rounded-xl mb-4"
        />
      ) : (
        <Image
          src={heroImage}
          alt={title}
          class="w-full h-48 object-cover rounded-xl mb-4"
          widths={[400, 800]}
          sizes="(max-width: 768px) 100vw, 400px"
        />
      )}
    </a>
  )}
  <div class="flex items-center gap-2 mb-2">
    <div class="flex items-center gap-1 px-2 py-0.5 bg-primary/10 text-primary rounded-full">
      <Calendar class="w-3 h-3" />
      <span class="text-[10px] font-bold uppercase tracking-wider">{weekRange}</span>
    </div>
  </div>
  <h3 class="text-xl font-bold group-hover:text-primary transition-colors mb-2">
    <a href={`/weekly/${weekly.slug}`}>{title}</a>
  </h3>
  <p class="text-gray-600 text-sm mb-3 line-clamp-2">{description}</p>
  <div class="flex items-center gap-2 text-xs text-gray-400">
    <div class="flex items-center gap-1">
      <MapPin class="w-3 h-3" />
      <span>{location}</span>
    </div>
    <span>â€¢</span>
    <span>{readingTime} min read</span>
  </div>
</article>
